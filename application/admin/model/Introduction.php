<?php/** * Created by PhpStorm. * User: Administrator * Date: 2019/7/26 * Time: 15:12 */namespace app\admin\model;class Introduction extends BaseModel{    //列表页    public function index($data, $limit)    {        $info = $this            ->order('id desc')            ->where($data)            ->paginate($limit);        return $info;    }    //添加    public function add_img($arr)    {        //数据处理        $arr['create_time'] = date('Y-m-d H:i:s', time());        $arr['update_time'] = date('Y-m-d H:i:s', time());        $info = $this->allowField(true)->save($arr);        if ($info) {            return 1; //添加成功        } else {            return 11; //添加失败        }    }    //删除    public function img_del($date)    {        $info = $this->where('id', $date)->find();        $del  = $this->where('id', $date)->delete();        if ($del) {            unlink($_SERVER["DOCUMENT_ROOT"] . $info['introduction_img']);            return 1; //删除成功        } else {            return 2;//删除失败        }    }    //修改信息    public function updateinfo($date)    {        $arr = $this->find($date);        return $arr;    }    /**     * 执行修改     * @param $date     */    public function updateedit($date)    {        $date['update_time'] = date('Y-m-d H:i:s', time());        if (empty($date['introduction_img'])) {            //没有修改图片            unset($date['introduction_img']);            $info = $this->allowField(true)->isUpdate(true)->update($date);            if ($info) {                return 1; //修改成功            } else {                return 11; //修改失败            }        } else {            //修改图片,修改成功删除图片            $picinfo = $this->where('id', $date['id'])->find();            $info = $this->allowField(true)->isUpdate(true)->update($date);            if ($info) {                unlink($_SERVER["DOCUMENT_ROOT"] . $picinfo['introduction_img']);                return 1; //修改成功            } else {                return 11; //修改失败            }        }    }}