<?php/** * Created by PhpStorm. * User: Administrator * Date: 2019/7/18 * Time: 9:26 */namespace app\admin\controller;use app\admin\model\User as UserModel;use think\Request;use think\Db;class User extends Base{    //列表页显示    public function index(Request $request)    {        if ($request->isAjax()) {            try {                $data=[];                if ($request->param('id')) {                    $data[] = ['id', '=', $request->param('id')];                }                if ($request->param('user_name')) {                    $user_name = $request->param('user_name');                    $data[] = ['user_name', 'like', "%$user_name%"];                }                if ($request->param('user_phone')) {                    $user_phone = $request->param('user_phone');                    $data[] = ['user_phone', 'like', "%$user_phone%"];                }                if ($request->param('user_sex')) {                    $data[] = ['user_sex', '=', $request->param('user_sex')];                }                $model = new UserModel();                $limit = $request->param('limit');                $info = $model->index($data,$limit);                $info = $info->toArray()['data'];                echo ajax($info, count($info), 'Success');            } catch (\Exception $exception) {                return $exception->getMessage();            }        }else{            return $this->fetch();        }    }    //添加轮播图片页面显示    public function add_img(Request $request)    {        if ($request->isPost()) {            //取所有值 先验证            $arr = json_decode($request->param('data'), true);            //字段验证            if(empty($arr['user_name'])){                return 2; //姓名不能为空            }else if(empty($arr['user_sex'])){                return 3; //性别不能为空            }else if(!preg_match('/^1[3|5|6|7|8]\d{9}$/', $arr['user_phone'])){                return 4; //电话号码格式不对            }else if(!preg_match("/^[a-zA-Z\d_]{6,}$/",$arr['user_password'])){                return 5; //请输入六位以上的数字字母            }else{                $model = new UserModel();                $info = $model->add_img($arr);                return $info;            }        }        $info = Db::table('kit_contact_tool')->select();        $this->assign('info',$info);        return $this->fetch();    }    //删除    public function img_del(Request $request)    {        if (!$request->param('id')) {            //参数不存在修改失败            return 2;        }else{            $model = new UserModel();            $info = $model->img_del($request->param('id'));            return $info;        }    }    //修改    public function update_edit(Request $request)    {        if ($request->isAjax()) {            //取所有值 先验证            $arr = json_decode($request->param('data'), true);            //字段验证            if(!preg_match('/^1[3|5|6|7|8]\d{9}$/', $arr['user_phone'])){                return 4; //电话号码格式不对            }else if(!preg_match("/^[a-zA-Z\d_]{6,}$/",$arr['user_password'])){                return 5; //请输入六位以上的数字字母            }else{                $model = new UserModel;                $info = $model->updateedit($arr);                return $info;            }        }else{            //取轮播图find一条在修改前显示的数据            $model = new UserModel();            $arr = $model->updateinfo($request->param('id'));            $this->assign('arr', $arr);            return $this->fetch();        }    }    /**     * 修改密码     * @return int|mixed     */    public function editpasseord()    {        if ($this->request->isAjax()){            $date = $this->postData('login');            if(!preg_match("/^[a-zA-Z\d_]{6,}$/",$date['user_password'])){                return 2; //密码格式不对            }else{                $model = new UserModel();                $info = $model->editpasseord($date);                if ($info) {                    return 1; //添加成功                } else {                    return 11; //添加失败                }            }        }        $this->assign('title','修改密码');        return $this->fetch('User/editpasseord');    }}