<?php/** * Created by PhpStorm. * User: Administrator * Date: 2019/7/26 * Time: 9:30 */namespace app\admin\controller;use app\admin\model\Pricing as PricingModel;use think\Request;use think\Db;class Pricing extends Base{    //列表页显示    public function index(Request $request)    {        if ($request->isAjax()) {            try {                $model = new PricingModel();                $info = $model->index($request->param('limit'));                echo ajax($info, count($info), 'Success');            } catch (\Exception $exception) {                return $exception->getMessage();            }        }else{            return $this->fetch();        }    }    //添加    public function add_img(Request $request)    {        if ($request->isPost()) {            //取所有值 先验证            $arr = json_decode($request->param('data'), true);            //字段验证            if(empty($arr['pricing_title'])){                return 2; //标题不能为空            }else if(empty($arr['pricing_licences_type'])){                return 3; //许可证类型不能为空            }else if(empty(preg_match('/^([0-9][1-9]*){1,10}$/',$arr['pricing_money']))){                return 4; //金额不能为空            }else{                $model = new PricingModel();                $info = $model->add_img($arr);                return $info;            }        }        $info = Db::table('kit_contact_tool')->select();        $this->assign('info',$info);        return $this->fetch();    }    //删除    public function img_del(Request $request)    {        if (!$request->param('id')) {            //参数不存在修改失败            return 2;        }else{            $model = new PricingModel();            $info = $model->img_del($request->param('id'));            return $info;        }    }    //修改    public function update_edit(Request $request)    {        if ($request->isAjax()) {            //取所有值 先验证            $arr = json_decode($request->param('data'), true);//            dump($arr);//            die;            //字段验证            if(empty($arr['pricing_title'])){                return 2; //标题不能为空            }else if(empty($arr['pricing_licences_type'])){                return 3; //许可证类型不能为空            }else if(empty(preg_match('/^([0-9][1-9]*){1,10}$/',$arr['pricing_money']))){                return 4; //请输入非负整数            }else{                $model = new PricingModel;                $info = $model->updateedit($arr);                return $info;            }        }else{            //取轮播图find一条在修改前显示的数据            $model = new PricingModel();            $info = $model->updateinfo($request->param('id'));            $this->assign('info', $info);            return $this->fetch();        }    }}